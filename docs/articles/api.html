<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tensoRphylo">
<title>API documentation • tensoRphylo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="API documentation">
<meta property="og:description" content="tensoRphylo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tensoRphylo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/tensoRphylo.html">Quickstart</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/modelingframework.html">Models</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/dataformat.html">Input</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/api.html">API</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-performance">Performance</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-performance">
    <a class="dropdown-item" href="../articles/validation.html">Validation</a>
    <a class="dropdown-item" href="../articles/comparison.html">Comparison</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>API documentation</h1>
            
      
      
      <div class="d-none name"><code>api.Rmd</code></div>
    </div>

    
    
<!-- This stuff is just for me for troubleshooting inside this document. -->
<div class="section level2">
<h2 id="notation-and-data-types">1 Notation and data types<a class="anchor" aria-label="anchor" href="#notation-and-data-types"></a>
</h2>
<p><code>tensoRphylo</code> is very particular about the types and sizes
of arguments you provide. Throughout this documentation I will use
<em>data types</em> as proxies for variables to make it clear what
<code>tensoRphylo</code> expects. I will indicate the data type and the
package of origin as <code>package::type</code>. I will also do this for
return types (when assigning a result to an object) to make it clear
what data types are generated by <code>tensoRphylo</code> objects.</p>
<p>When relevant, I will also provide an indication of the correct
dimensionality of the object using parantheses. The parantheses will
contain comma-separate values that indicate the size of each dimension
of the object. For example, when I mean to indicate that an argument
should be a single numeric value (a scalar), I will write
<code>base::numeric(1)</code>. When I mean that the argument should be a
numeric vector, I will write <code>base::numeric(s)</code> to indicate a
vector of length <code>s</code>. When I mean that the argument should be
a numeric matrix, I will write <code>base::matrix(r, c)</code>, where
<code>n</code> indicates the number of rows and <code>c</code> indicates
the number of columns.</p>
<p>The dimensions of many of the objects are determined by the number of
tips in the tree or the number of states in the data matrix. I will use
<code>num_tips</code> as a proxy for the number of tips, and
<code>num_states</code> as a proxy for the number of states.</p>
</div>
<div class="section level2">
<h2 id="constructors">2 Constructors<a class="anchor" aria-label="anchor" href="#constructors"></a>
</h2>
<p>Create a <code>TensorPhyloInstance</code> with the
<code>makeTensorPhylo</code>. You <em>must</em> provide a phylogeny, and
also either: 1) a character dataset, or 2) the number of missing
character states. See the <a href="dataformat.hmtl">Input</a> for more
details about data format.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create an instance with a tree and a character vector.</span>
<span class="co"># supports ambiguity and missing data.</span>
<span class="va">tp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TensorPhyloInstance.html">makeTensorPhylo</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">phylo</a></span>,
                      data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="va">num_tips</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create an instance with a tree and a numeric vector.</span>
<span class="co"># does not support ambiguity or missing data.</span>
<span class="va">tp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TensorPhyloInstance.html">makeTensorPhylo</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">phylo</a></span>,
                      data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_tips</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create an instance with a tree and a numeric matrix.</span>
<span class="co"># supports ambiguity and missing data.</span>
<span class="va">tp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TensorPhyloInstance.html">makeTensorPhylo</a></span><span class="op">(</span>tree <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">phylo</a></span>,
                      data <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_tips</span>, <span class="va">num_states</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create an instance with a tree but no data.</span>
<span class="co"># create a missing character with `num_states` states.</span>
<span class="va">tp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TensorPhyloInstance.html">makeTensorPhylo</a></span><span class="op">(</span>tree       <span class="op">=</span> <span class="fu">ape</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">phylo</a></span>,
                      num_states <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-probabilities">3 Computing probabilities<a class="anchor" aria-label="anchor" href="#computing-probabilities"></a>
</h2>
<p>The core functionality of a <code>TensorPhyloInstance</code> is to
compute the likelihood of the currently active model/parameters. This
includes the parameters of the diversification model, state-change
model, and root frequency model, as well as the chosen conditional
probability type, each of which is described below. Compute the
likelihood like so:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compute the log likelihood</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tp</span><span class="op">$</span><span class="fu">computeLogLikelihood</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="labeled-trees">3.1 Labeled trees<a class="anchor" aria-label="anchor" href="#labeled-trees"></a>
</h3>
<p>By default, a <code>TensorPhyloInstance</code> will compute the
probability density of the <em>labeled</em> tree and states, which
includes a combinatorial constant, as described in <span class="citation">Stadler (2013)</span>. However, most comparable
<code>R</code> implementations of state-dependent birth-death models
(<em>e.g.</em> <code>diversitree</code> and <code>hisse</code>) do not
include this constant. To suppress this constant, do:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># turn off the combinatorial constant</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setApplyTreeLikCorrection</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># turn on the combinatorial constant (default)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setApplyTreeLikCorrection</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="lineage-specific-diversification-models">4 Lineage-specific diversification models<a class="anchor" aria-label="anchor" href="#lineage-specific-diversification-models"></a>
</h2>
<p>Lineage-specific diversification events occur independently among
lineages, but can depend on the character state and/or time. There are
for types of events: speciation, extinction, sampling, and destructive
sampling (simultaneous sampling and extinction). Each type of event can
occur according to one of four models: constant, state-dependent,
time-dependent or time-and-state-dependent. The type of model can be
different for different types of events.</p>
<div class="section level3">
<h3 id="time-dependent-diversification-models">4.1 Time-dependent diversification models<a class="anchor" aria-label="anchor" href="#time-dependent-diversification-models"></a>
</h3>
<p>The time-dependent models assume that rates are the same between
discrete rate-change events. The times of the rate-change events are
measured backward in time, so that <span class="math inline">\(t =
0\)</span> is the present and <span class="math inline">\(t &gt;
0\)</span> is some time in the past. The times should be in ascending
order, such that more recent events appear first.</p>
<p>A model with <code>n</code> rate-change times will have
<code>n + 1</code> time intervals. The last interval is “open” in the
sense that it covers all time after the <code>n</code><sup>th</sup> time
point. You will need to provide <code>n + 1</code> parameters (or sets
of parameters), one per interval. These should be ordered so that the
first set of parameters corresponds to the first interval, the second
corresponds to the second interval, etc.</p>
</div>
<div class="section level3">
<h3 id="speciation-events">4.2 Speciation events<a class="anchor" aria-label="anchor" href="#speciation-events"></a>
</h3>
<p>During a speciation event, the affected lineage speciates, producing
two new lineages. If the model includes cladogenetic character change
(see below), the lineage experiences cladogenetic evolution according to
the cladogenetic process at that time; otherwise, the new lineages
inherit the ancestor’s state. Speciation events are described by the
parameter <span class="math inline">\(\lambda\)</span>; the
corresponding functions include <code>lambda</code> in their name.</p>
<div class="section level4">
<h4 id="constant-speciation-events">4.2.1 Constant speciation events<a class="anchor" aria-label="anchor" href="#constant-speciation-events"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a single speciation-rate parameter that applies to all</span>
<span class="co"># states and all times</span>
<span class="va">speciation_rate</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setLambdaConstant</span><span class="op">(</span><span class="va">speciation_rate</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-speciation-events">4.2.2 State-dependent speciation events<a class="anchor" aria-label="anchor" href="#state-dependent-speciation-events"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a state-dependent speciation-rate parameter that does</span>
<span class="co"># not vary over time</span>
<span class="va">speciation_rates</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setLambdaStateDependent</span><span class="op">(</span><span class="va">speciation_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-speciation-events">4.2.3 Time-dependent speciation events<a class="anchor" aria-label="anchor" href="#time-dependent-speciation-events"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent speciation-rate parameter that does not </span>
<span class="co"># depend on the state</span>
<span class="va">speciation_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">speciation_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setLambdaStateDependent</span><span class="op">(</span><span class="va">speciation_change_times</span>, <span class="va">speciation_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-and-state-dependent-speciation-events">4.2.4 Time-and-state-dependent speciation events<a class="anchor" aria-label="anchor" href="#time-and-state-dependent-speciation-events"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent speciation-rate that depends </span>
<span class="co"># on the state</span>
<span class="va">speciation_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">speciation_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setLambdaTimeStateDependent</span><span class="op">(</span><span class="va">speciation_change_times</span>, <span class="va">speciation_rates</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="extinction-events">4.3 Extinction events<a class="anchor" aria-label="anchor" href="#extinction-events"></a>
</h3>
<p>During an extinction event, the affected lineages goes extinct.
Extinction events are described by the parameter <span class="math inline">\(\mu\)</span>; the corresponding functions include
<code>mu</code> in their name.</p>
<div class="section level4">
<h4 id="constant-extinction-events">4.3.1 Constant extinction events<a class="anchor" aria-label="anchor" href="#constant-extinction-events"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a single extinction-rate parameter that applies to all</span>
<span class="co"># states and all times</span>
<span class="va">extinction_rate</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setMuConstant</span><span class="op">(</span><span class="va">extinction_rate</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-extinction-events">4.3.2 State-dependent extinction events<a class="anchor" aria-label="anchor" href="#state-dependent-extinction-events"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a state-dependent extinction-rate parameter that does</span>
<span class="co"># not vary over time</span>
<span class="va">extinction_rates</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setMuStateDependent</span><span class="op">(</span><span class="va">extinction_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-extinction-events">4.3.3 Time-dependent extinction events<a class="anchor" aria-label="anchor" href="#time-dependent-extinction-events"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent extinction-rate parameter that does not </span>
<span class="co"># depend on the state</span>
<span class="va">extinction_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">extinction_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setMuStateDependent</span><span class="op">(</span><span class="va">extinction_change_times</span>, <span class="va">extinction_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-and-state-dependent-extinction-events">4.3.4 Time-and-state-dependent extinction events<a class="anchor" aria-label="anchor" href="#time-and-state-dependent-extinction-events"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent extinction-rate parameter that depends </span>
<span class="co"># on the state</span>
<span class="va">extinction_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">extinction_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setMuTimeStateDependent</span><span class="op">(</span><span class="va">extinction_change_times</span>, <span class="va">extinction_rates</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="sampling-events">4.4 Sampling events<a class="anchor" aria-label="anchor" href="#sampling-events"></a>
</h3>
<p>During a sampling event, the affected lineages produces a sample.
Sampling events are described by the parameter <span class="math inline">\(\phi\)</span>; the corresponding functions include
<code>phi</code> in their name.</p>
<div class="section level4">
<h4 id="constant-sampling-events">4.4.1 Constant sampling events<a class="anchor" aria-label="anchor" href="#constant-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a single sampling-rate parameter that applies to all</span>
<span class="co"># states and all times</span>
<span class="va">sampling_rate</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setPhiConstant</span><span class="op">(</span><span class="va">sampling_rate</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-sampling-events">4.4.2 State-dependent sampling events<a class="anchor" aria-label="anchor" href="#state-dependent-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a state-dependent sampling-rate parameter that does</span>
<span class="co"># not vary over time</span>
<span class="va">sampling_rates</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setPhiStateDependent</span><span class="op">(</span><span class="va">sampling_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-sampling-events">4.4.3 Time-dependent sampling events<a class="anchor" aria-label="anchor" href="#time-dependent-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent sampling-rate parameter that does not </span>
<span class="co"># depend on the state</span>
<span class="va">sampling_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">sampling_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setPhiStateDependent</span><span class="op">(</span><span class="va">sampling_change_times</span>, <span class="va">sampling_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-and-state-dependent-sampling-events">4.4.4 Time-and-state-dependent sampling events<a class="anchor" aria-label="anchor" href="#time-and-state-dependent-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent sampling-rate parameter that that depends </span>
<span class="co"># on the state</span>
<span class="va">sampling_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">sampling_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setPhiTimeStateDependent</span><span class="op">(</span><span class="va">sampling_change_times</span>, <span class="va">sampling_rates</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="destructive-sampling-events">4.5 Destructive-sampling events<a class="anchor" aria-label="anchor" href="#destructive-sampling-events"></a>
</h3>
<p>During a destructive-sampling event, the affected lineages produces a
sample and simultaneously goes extinct. Destructive-sampling events are
described by the parameter <span class="math inline">\(\phi\)</span>;
the corresponding functions include <code>phi</code> in their name.</p>
<div class="section level4">
<h4 id="constant-destructive-sampling-events">4.5.1 Constant destructive-sampling events<a class="anchor" aria-label="anchor" href="#constant-destructive-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a single destructive-sampling-rate parameter that applies to all</span>
<span class="co"># states and all times</span>
<span class="va">destructive_sampling_rate</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDeltaConstant</span><span class="op">(</span><span class="va">destructive_sampling_rate</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-destructive-sampling-events">4.5.2 State-dependent destructive-sampling events<a class="anchor" aria-label="anchor" href="#state-dependent-destructive-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a state-dependent destructive-sampling-rate parameter that does</span>
<span class="co"># not vary over time</span>
<span class="va">destructive_sampling_rates</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDeltaStateDependent</span><span class="op">(</span><span class="va">destructive_sampling_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-destructive-sampling-events">4.5.3 Time-dependent destructive-sampling events<a class="anchor" aria-label="anchor" href="#time-dependent-destructive-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent destructive-sampling-rate parameter that does not </span>
<span class="co"># depend on the state</span>
<span class="va">destructive_sampling_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">destructive_sampling_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDeltaStateDependent</span><span class="op">(</span><span class="va">destructive_sampling_change_times</span>, 
                          <span class="va">destructive_sampling_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-and-state-dependent-destructive-sampling-events">4.5.4 Time-and-state-dependent destructive-sampling events<a class="anchor" aria-label="anchor" href="#time-and-state-dependent-destructive-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a time-dependent destructive-sampling-rate parameter that depends </span>
<span class="co"># on the state</span>
<span class="va">destructive_sampling_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">destructive_sampling_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDeltaTimeStateDependent</span><span class="op">(</span><span class="va">destructive_sampling_change_times</span>, 
                              <span class="va">destructive_sampling_rates</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mass-diversification-models">5 Mass-diversification models<a class="anchor" aria-label="anchor" href="#mass-diversification-models"></a>
</h2>
<p>In contrast to lineage-specific-diversification events,
mass-diversification events affect all lineages living at a given time.
There are four types of mass-diversification events: mass-speciation,
mass-extinction, mass-sampling and mass-destructive-sampling. Each event
is associated with a magnitude, which is the probability that the event
occurs to a given lineages. These magnitude may be independent of the
state of the lineage (a “constant” event), or it may be
state-dependent.</p>
<p>Each mass-diversification event occurs at a particular time with a
particular magnitude (or set of state-dependent magnitudes). There can
be multiple events of a given type, each with different event times. The
times of the events are measured backward in time, so that <span class="math inline">\(t = 0\)</span> is the present and <span class="math inline">\(t &gt; 0\)</span> is some time in the past. You
should provide the times of the events in ascending order, such that
more recent events appear first; the magnitudes should be ordered
accordingly.</p>
<div class="section level3">
<h3 id="mass-speciation-events">5.1 Mass-speciation events<a class="anchor" aria-label="anchor" href="#mass-speciation-events"></a>
</h3>
<p>Mass-speciation events are described by the parameter <span class="math inline">\(\Upsilon\)</span>; the corresponding functions
include <code>Upsilon</code> in their name. During a mass-speciation
event, all lineages in state <span class="math inline">\(i\)</span>
alive at the time experience a speciation event with probability <span class="math inline">\(\Upsilon_i\)</span>. If the model includes
cladogenetic character change (see below), the speciating lineages
experience cladogenetic evolution according to the cladogenetic process
at that time; otherwise, both daughters inherit the ancestor’s
state.</p>
<div class="section level4">
<h4 id="state-independent-mass-speciation-events">5.1.1 State-independent mass-speciation events<a class="anchor" aria-label="anchor" href="#state-independent-mass-speciation-events"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-independent mass-speciation events at given times</span>
<span class="va">mass_speciation_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_speciation_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setUpsilonConstant</span><span class="op">(</span><span class="va">mass_speciation_times</span>, <span class="va">mass_speciation_probability</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-mass-speciation-events">5.1.2 State-dependent mass-speciation events<a class="anchor" aria-label="anchor" href="#state-dependent-mass-speciation-events"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-dependent mass-speciation events at given times</span>
<span class="va">mass_speciation_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_speciation_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setUpsilonStateDependent</span><span class="op">(</span><span class="va">mass_speciation_times</span>, <span class="va">mass_speciation_probability</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="mass-extinction-events">5.2 Mass-extinction events<a class="anchor" aria-label="anchor" href="#mass-extinction-events"></a>
</h3>
<p>Mass-extinction events are described by the parameter <span class="math inline">\(\Gamma\)</span>; the corresponding functions
include <code>Gamma</code> in their name. During a mass-extinction
event, all lineages in state <span class="math inline">\(i\)</span>
alive at the time experience an extinction event with probability <span class="math inline">\(\Gamma_i\)</span>.</p>
<div class="section level4">
<h4 id="state-independent-mass-extinction-events">5.2.1 State-independent mass-extinction events<a class="anchor" aria-label="anchor" href="#state-independent-mass-extinction-events"></a>
</h4>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-independent mass-extinction events at given times</span>
<span class="va">mass_extinction_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_extinction_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setGammaConstant</span><span class="op">(</span><span class="va">mass_extinction_times</span>, <span class="va">mass_extinction_probability</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-mass-extinction-events">5.2.2 State-dependent mass-extinction events<a class="anchor" aria-label="anchor" href="#state-dependent-mass-extinction-events"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-dependent mass-extinction events at given times</span>
<span class="va">mass_extinction_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_extinction_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setGammaStateDependent</span><span class="op">(</span><span class="va">mass_extinction_times</span>, <span class="va">mass_extinction_probability</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="mass-sampling-events">5.3 Mass-sampling events<a class="anchor" aria-label="anchor" href="#mass-sampling-events"></a>
</h3>
<p>Mass-sampling events are described by the parameter <span class="math inline">\(R\)</span>; the corresponding functions include
<code>Rho</code> in their name. During a mass-sampling event, all
lineages in state <span class="math inline">\(i\)</span> alive at the
time experience a sampling event with probability <span class="math inline">\(R_i\)</span>.</p>
<div class="section level4">
<h4 id="state-independent-mass-sampling-at-the-present">5.3.1 State-independent mass-sampling at the present<a class="anchor" aria-label="anchor" href="#state-independent-mass-sampling-at-the-present"></a>
</h4>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a state-independent mass-sampling event at the present (t = 0)</span>
<span class="va">mass_sampling_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setRhoPresent</span><span class="op">(</span><span class="va">mass_sampling_probability</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-mass-sampling-at-the-present">5.3.2 State-dependent mass-sampling at the present<a class="anchor" aria-label="anchor" href="#state-dependent-mass-sampling-at-the-present"></a>
</h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify a state-dependent mass-sampling event at the present (t = 0)</span>
<span class="va">mass_sampling_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setRhoPresentStateDependent</span><span class="op">(</span><span class="va">mass_sampling_probability</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-independent-mass-sampling-events">5.3.3 State-independent mass-sampling events<a class="anchor" aria-label="anchor" href="#state-independent-mass-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-independent mass-sampling events at given times</span>
<span class="va">mass_sampling_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_sampling_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setRhoConstant</span><span class="op">(</span><span class="va">mass_sampling_times</span>, <span class="va">mass_sampling_probability</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-mass-ampling-events">5.3.4 State-dependent mass-ampling events<a class="anchor" aria-label="anchor" href="#state-dependent-mass-ampling-events"></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-dependent mass-sampling events at given times</span>
<span class="va">mass_sampling_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_sampling_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setRhoStateDependent</span><span class="op">(</span><span class="va">mass_sampling_times</span>, <span class="va">mass_sampling_probability</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="mass-destructive-sampling-events">5.4 Mass-destructive-sampling events<a class="anchor" aria-label="anchor" href="#mass-destructive-sampling-events"></a>
</h3>
<p>Mass-destructive-sampling events are described by the parameter <span class="math inline">\(\Xi\)</span>; the corresponding functions include
<code>Xi</code> in their name. During a mass-destructive-sampling event,
all lineages in state <span class="math inline">\(i\)</span> alive at
the time experience a destructive-sampling event with probability <span class="math inline">\(\Xi_i\)</span>.</p>
<div class="section level4">
<h4 id="state-independent-mass-destructive-sampling-events">5.4.1 State-independent mass-destructive-sampling events<a class="anchor" aria-label="anchor" href="#state-independent-mass-destructive-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-independent mass-destructive-sampling events at given times</span>
<span class="va">mass_destructive_sampling_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_destructive_sampling_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setXiConstant</span><span class="op">(</span><span class="va">mass_destructive_sampling_times</span>, 
                 <span class="va">mass_destructive_sampling_probability</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="state-dependent-mass-destructive-sampling-events">5.4.2 State-dependent mass-destructive-sampling events<a class="anchor" aria-label="anchor" href="#state-dependent-mass-destructive-sampling-events"></a>
</h4>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-dependent mass-sampling events at given times</span>
<span class="va">mass_destructive_sampling_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_destructive_sampling_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setXiStateDependent</span><span class="op">(</span><span class="va">mass_destructive_sampling_times</span>, 
                       <span class="va">mass_destructive_sampling_probability</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="state-change-models">6 State-change models<a class="anchor" aria-label="anchor" href="#state-change-models"></a>
</h2>
<p>There are two types of state-change events: “anagenetic” events,
which occur along lineages and are not associated with speciation
events, and “cladogenetic” events, which are associated with speciation
events. Both types of events can occur according to two models: constant
and time-dependent.</p>
<div class="section level3">
<h3 id="time-dependent-state-change-models">6.1 Time-dependent state-change models<a class="anchor" aria-label="anchor" href="#time-dependent-state-change-models"></a>
</h3>
<p>The time-dependent models assume that state-change events are the
same between discrete shift events. The times of the shift events are
measured backward in time, so that <span class="math inline">\(t =
0\)</span> is the present and <span class="math inline">\(t &gt;
0\)</span> is some time in the past. The times should be in ascending
order, such that more recent events appear first.</p>
<p>A model with <code>n</code> shift events will have <code>n + 1</code>
time intervals. The last interval is “open” in the sense that it covers
all time after the <code>n</code><sup>th</sup> time point. You will need
to provide <code>n + 1</code> parameters (or sets of parameters), one
per interval. These should be ordered so that the first set of
parameters corresponds to the first interval, the second corresponds to
the second interval, etc.</p>
</div>
<div class="section level3">
<h3 id="anagenetic-events">6.2 Anagenetic events<a class="anchor" aria-label="anchor" href="#anagenetic-events"></a>
</h3>
<p>During an anagenetic state-change event, a lineage changes from state
<em>i</em> to state <em>j</em>. The rate at which these events occurs is
described by a rate matrix, <span class="math inline">\(H\)</span>
(denoted <code>Eta</code> in the functions below). The rate at which a
lineage in state <em>i</em> changes to state <em>j</em> is <span class="math inline">\(\eta_{ij}\)</span>. This rate matrix is analogous
to the instantaneous-rate matrix, <span class="math inline">\(Q\)</span>, used in standard continuous-time
Markov models used to describe discrete-character evolution. See the
documentation for <code>tensoRphylo::RateMatrix</code> for more
information about rate matrices.</p>
<div class="section level4">
<h4 id="constant-symmetrical-anagenetic-events">6.2.1 Constant, symmetrical anagenetic events<a class="anchor" aria-label="anchor" href="#constant-symmetrical-anagenetic-events"></a>
</h4>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify constant-rate, symmetrical anagenetic process</span>
<span class="va">transition_rate</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setEtaConstantEqual</span><span class="op">(</span><span class="va">transition_rate</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="constant-asymmetrical-anagenetic-events">6.2.2 Constant, asymmetrical anagenetic events<a class="anchor" aria-label="anchor" href="#constant-asymmetrical-anagenetic-events"></a>
</h4>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify constant-rate, asymmetrical anagenetic process</span>
<span class="va">transition_matrix</span> <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu">RateMatrix</span><span class="op">(</span><span class="va">num_states</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setEtaConstantUnequal</span><span class="op">(</span><span class="va">transition_matrix</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-symmetrical-anagenetic-events">6.2.3 Time-dependent, symmetrical anagenetic events<a class="anchor" aria-label="anchor" href="#time-dependent-symmetrical-anagenetic-events"></a>
</h4>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify time-dependent, symmetrical anagenetic process</span>
<span class="va">transition_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">transition_rates</span>        <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setEtaTimeDependentEqual</span><span class="op">(</span><span class="va">transition_change_times</span>, <span class="va">transition_rates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-asymmetrical-anagenetic-events">6.2.4 Time-dependent, asymmetrical anagenetic events<a class="anchor" aria-label="anchor" href="#time-dependent-asymmetrical-anagenetic-events"></a>
</h4>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify time-dependent, symmetrical anagenetic process</span>
<span class="va">transition_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">transition_matrix</span>       <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu">RateMatrix</span><span class="op">(</span><span class="va">num_states</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">transition_matrices</span>     <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu"><a href="../reference/makeRateMatrix.html">RateMatrixList</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setEtaTimeDependentUnequal</span><span class="op">(</span><span class="va">transition_change_times</span>, <span class="va">transition_matrices</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mass-anagenetic-events">6.2.5 Mass-anagenetic events<a class="anchor" aria-label="anchor" href="#mass-anagenetic-events"></a>
</h4>
<p>A mass-anagenetic event occurs at a particular time, <span class="math inline">\(t\)</span>; all lineages alive at time <span class="math inline">\(t\)</span> experience anagenetic change according
to the probability matrix <span class="math inline">\(Z\)</span>; <span class="math inline">\(\zeta_{ij}\)</span> is the probability that a
lineage in state <em>i</em> changes to state <em>j</em> during the
event. See the documentation for
<code>tensoRphylo::ProbabilityMatrix</code> for more information about
probability matrices (and lists of probability matrices).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify mass-anagenetic events</span>
<span class="va">mass_transition_times</span>    <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_transition_events</span><span class="op">)</span>
<span class="va">mass_transition_matrix</span>   <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu">ProbabilityMatrix</span><span class="op">(</span><span class="va">num_states</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">mass_transition_matrices</span> <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu"><a href="../reference/makeProbabilityMatrix.html">ProbabilityMatrixList</a></span><span class="op">(</span><span class="va">num_transition_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setZeta</span><span class="op">(</span><span class="va">mass_transition_times</span>, <span class="va">mass_transition_matrices</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mass-extinction-and-anagensis-events">6.2.6 Mass-extinction-and-anagensis events<a class="anchor" aria-label="anchor" href="#mass-extinction-and-anagensis-events"></a>
</h4>
<p>We can model simultaneous mass-extinction and anagenetic character
change. To do so, we simply combine the mass-extinction and
mass-anagenesis parameters, <span class="math inline">\(\Gamma\)</span>
and <span class="math inline">\(Z\)</span>. You must provide one <span class="math inline">\(Z\)</span> matrix per mass-extinction event. NOTE:
We originally implemented mass-anagenetic events to accommodate changes
in state associated with mass-extinction events. Consequently, you
cannot model mass-anagenetic events and mass-extinction-and-anagenesis
events separately. We intend to relax this dependence in the future.</p>
<p>In these examples, state-independent and state-dependent refers to
the magnitudes of the mass-extinction events.</p>
<div class="section level5">
<h5 id="state-independent-mass-extinction-event-with-anagenesis">6.2.6.1 State-independent mass-extinction event with anagenesis<a class="anchor" aria-label="anchor" href="#state-independent-mass-extinction-event-with-anagenesis"></a>
</h5>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-independent mass-extinction-and-anagensis events at given times</span>
<span class="va">mass_extinction_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_extinction_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_transition_matrices</span>    <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu"><a href="../reference/makeProbabilityMatrix.html">ProbabilityMatrixList</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setGammaAndZetaConstant</span><span class="op">(</span><span class="va">mass_extinction_times</span>, 
                           <span class="va">mass_extinction_probability</span>,
                           <span class="va">mass_transition_matrices</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level5">
<h5 id="state-dependent-mass-extinction-event-with-anagenesis">6.2.6.2 State-dependent mass-extinction event with anagenesis<a class="anchor" aria-label="anchor" href="#state-dependent-mass-extinction-event-with-anagenesis"></a>
</h5>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify state-dependent mass-extinction-and-anagensis events at given times</span>
<span class="va">mass_extinction_times</span>       <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">mass_extinction_probability</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">num_events</span>, <span class="va">num_states</span><span class="op">)</span>
<span class="va">mass_transition_matrices</span>    <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu"><a href="../reference/makeProbabilityMatrix.html">ProbabilityMatrixList</a></span><span class="op">(</span><span class="va">num_events</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setGammaAndZetaStateDependent</span><span class="op">(</span><span class="va">mass_extinction_times</span>, 
                                 <span class="va">mass_extinction_probability</span>,
                                 <span class="va">mass_transition_matrices</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="cladogenetic-events">6.3 Cladogenetic events<a class="anchor" aria-label="anchor" href="#cladogenetic-events"></a>
</h3>
<p>During a cladogenetic state-change event, a lineage in state
<em>i</em> leaves one lineage in state <em>j</em> and another lineage in
state <em>k</em>. In <code>tensoRphylo</code>, cladogenetic rates do not
occur with a <em>rate</em>; rather, they occur with some probability
whenever a speciation event occurs. The probability that a lineage in
state <em>i</em> leaves one lineage in state <em>j</em> and another in
state <em>k</em> is <span class="math inline">\(\omega_{ijk}\)</span>.
We represent these probabilities in a three-dimensional array, <span class="math inline">\(\Omega\)</span> (denoted <code>Omega</code>
below), where the first dimension corresponds to the ancestral state,
the second dimension to the state of one daughter lineage, and the third
dimension to the state of the second daughter lineage. See the
documentation for <code>tensoRphylo::CladoEvents</code> for more
information about creating these arrays.</p>
<p>(Other software typically combines the speciation rate with the
cladogenetic event probability. For example, in
<code>diversitree</code>, the rate at which a lineage in state
<em>i</em> speciates and produces one lineage in state <em>j</em> and
another in state <em>k</em> is denoted <span class="math inline">\(\lambda_{ijk}\)</span>. The equivalent value in
<code>tensoRphylo</code> is <span class="math inline">\(\lambda_i \times
\omega_{ijk}\)</span>. We chose this alternative parameterization in
<code>TensorPhylo</code> because it makes it more concise to express a
non-cladogenetic model as a special case of a cladogenetic model.)</p>
<div class="section level4">
<h4 id="constant-cladogenetic-events">6.3.1 Constant cladogenetic events<a class="anchor" aria-label="anchor" href="#constant-cladogenetic-events"></a>
</h4>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify constant-rate cladogenetic process</span>
<span class="va">cladogenetic_array</span> <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu">CladoEvents</span><span class="op">(</span><span class="va">num_states</span>, 
                                               <span class="va">num_states</span>, 
                                               <span class="va">num_states</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setOmegaConstant</span><span class="op">(</span><span class="va">cladogenetic_array</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-dependent-cladogenetic-events">6.3.2 Time-dependent cladogenetic events<a class="anchor" aria-label="anchor" href="#time-dependent-cladogenetic-events"></a>
</h4>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify time-dependent cladogenetic process</span>
<span class="va">cladogenetic_change_times</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_rate_shifts</span><span class="op">)</span>
<span class="va">cladogenetic_arrays</span> <span class="op">&lt;-</span> <span class="fu">tensoRphylo</span><span class="fu">::</span><span class="fu"><a href="../reference/makeCladogeneticEvents.html">CladoEventsList</a></span><span class="op">(</span><span class="va">num_rate_shifts</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setOmegaTimeDependent</span><span class="op">(</span><span class="va">cladogenetic_change_times</span>, <span class="va">cladogenetic_arrays</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mass-cladogenetic-events">6.3.3 Mass-cladogenetic events<a class="anchor" aria-label="anchor" href="#mass-cladogenetic-events"></a>
</h4>
<p>Because cladogenetic state-change events only occur at speciation
events, mass-cladogenetic state-change events are not explicitly
modeled. Rather, they are <em>implied</em> if you use a model with
mass-speciation events and cladogenetic state changes. When a lineage
speciates during a mass-speciation event at time <span class="math inline">\(t\)</span>, that lineage experiences cladogenetic
state changes just as it would during a normal speciation event at that
time (including any time-dependence in the cladogenetic state-change
process).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="root-prior-models">7 Root prior models<a class="anchor" aria-label="anchor" href="#root-prior-models"></a>
</h2>
<p>The root prior parameter controls the probability that the tree
begins in each possible state. By default, we assume a flat root
frequency prior. However, you can also use a specified root frequency
(<em>i.e.</em>, something other than a uniform), or the quasistationary
frequency.</p>
<div class="section level3">
<h3 id="uniform-root-prior-default">7.1 Uniform root prior (default)<a class="anchor" aria-label="anchor" href="#uniform-root-prior-default"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify uniform probability over all states at the beginning of the tree</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setRootPriorFlat</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="non-uniform-root-prior">7.2 Non-uniform root prior<a class="anchor" aria-label="anchor" href="#non-uniform-root-prior"></a>
</h3>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify probability distribution over all states at the beginning of the tree</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setRootPrior</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="quasistationary-frequency-prior">7.3 Quasistationary frequency prior<a class="anchor" aria-label="anchor" href="#quasistationary-frequency-prior"></a>
</h3>
<p>The quasistationary frequency is the frequency of lineages in each
possible state after a long (infinite) period of time, taking into
account differential diversification rates and the assumed state-change
model (including both anagenesis and cladogenesis).</p>
<p>The quasistationary frequency assumes the tree evolves under a given
process for an infinite amount of time (assuming it doesn’t go extinct)
but doesn’t experience mass events of any type. If you use this option,
<code>TensorPhylo</code> will use the parameters at the beginning of the
tree (the root or stem) to determine the quasistationary frequency.
Consequently, this option doesn’t really make sense for models where the
parameters changes over time, or when there are mass events of any type,
because the process may not be quasi-stationary.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># tell tensorphylo to use the quasistationary frequency for the root prior</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setQuasistationaryFrequencyMode</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>You can also query the <code>TensorPhyloInstance</code> for its
quasistationary frequency for the parameters at a particular time, <span class="math inline">\(t\)</span>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># check the quasistationary frequency of the parameters at a particular time</span>
<span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">num_states</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tp</span><span class="op">$</span><span class="fu">getQuasiStationaryFrequency</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conditional-probabilities">8 Conditional probabilities<a class="anchor" aria-label="anchor" href="#conditional-probabilities"></a>
</h2>
<p>Conditional probabilities represent ascertainment corrections induced
by not studying some fraction of outcomes under the model. For example,
<em>conditioning on survival</em> implies that we would not study trees
that did not survive to the present. The type of conditioning to use
depends on whether the tree begins with 1 or 2 lineages, and how you
choose to model sampling. These options are discussed in more detail in
the <code><a href="../reference/conditionalProbability.html">tensoRphylo::conditionalProbability</a></code> documentation.</p>
<p>Conditional probability settings are implemented as named elements of
the global <code><a href="../reference/conditionalProbability.html">tensoRphylo::conditionalProbability</a></code> object. To
apply a particular correction, provide it to the
<code>TensorPhyloInstance</code> like so:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># condition the process on the two descendants of the root producing at least</span>
<span class="co"># one extant descendant each. this is equivalent to conditioning on "survival"</span>
<span class="co"># in most other software.</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setConditionalProbabilityType</span><span class="op">(</span><span class="va">conditionalProbability</span><span class="op">$</span><span class="va">ROOT_MRCA</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="stochastic-mapping">9 Stochastic mapping<a class="anchor" aria-label="anchor" href="#stochastic-mapping"></a>
</h2>
<div class="section level3">
<h3 id="generate-a-sample-of-stochastic-maps">9.1 Generate a sample of stochastic maps<a class="anchor" aria-label="anchor" href="#generate-a-sample-of-stochastic-maps"></a>
</h3>
<p>Simulate stochastic maps in <code>phytools</code> format. This
simulation can take a bit of time, but you can stop it early, returning
the replicates that have completed.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulate `reps` stochastic maps</span>
<span class="fu">phytools</span><span class="fu">::</span><span class="fu">multiSimmap</span><span class="op">(</span><span class="va">reps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tp</span><span class="op">$</span><span class="fu">drawStochasticMaps</span><span class="op">(</span>reps <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulate-the-average-diversification-rates-per-branch">9.2 Simulate the average diversification rates per branch<a class="anchor" aria-label="anchor" href="#simulate-the-average-diversification-rates-per-branch"></a>
</h3>
<p>This function computes the average diversification rate for each
branch using stochastic mapping. For each stochastic map, computes the
diversification rate on each branch as the weighted average of the
state-dependent diversification- and sampling-rate parameters. Returns a
list of matrices, each of which corresponds to the branch-specific (in
rows) average diversification and sampling rates (columns).</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate `reps` branch rates</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>base<span class="sc">::</span>list<span class="sc">&lt;</span>base<span class="sc">::</span><span class="fu">matrix</span>(num_branches,<span class="dv">5</span>)<span class="sc">&gt;</span>(reps) <span class="ot">&lt;-</span> tp<span class="sc">$</span><span class="fu">drawBranchRates</span>(<span class="at">reps =</span> base<span class="sc">::</span><span class="fu">numeric</span>(<span class="dv">1</span>))</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="other-settings">10 Other settings<a class="anchor" aria-label="anchor" href="#other-settings"></a>
</h2>
<div class="section level3">
<h3 id="parallel-processing">10.1 Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h3>
<p><code>TensorPhylo</code> implements parallel processing with
<code>OpenMP</code>. To specify the number of threads to use, simply do
as follows:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify the number of threads to use</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setNumberOfThreads</span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that only certain likelihood algorithms will actually use
multiple threads; see the <a href="#approximators">Likelihood
algorithms</a> section for details. Depending on the size of the tree
and the number of character states, parallel processing will sometimes
not be worthwhile, or even be detrimental. Parallel processing works the
best with large numbers of states and/or with cladogenetic models. See
the <a href="comparison.html#multicore">Multiprocessing performance
comparison</a> for some idea of what to expect.</p>
</div>
<div class="section level3">
<h3 id="integrators">10.2 Numerical integrators<a class="anchor" aria-label="anchor" href="#integrators"></a>
</h3>
<p><code>TensorPhylo</code> uses <code>boost/odeint</code> numerical
integrators for solving ODEs. These integrators vary in terms of their
speed and accuracy, but the default one is generally quite good. For
more information, see the <code><a href="../reference/integrationScheme.html">tensoRphylo::integrationScheme</a></code>
documentation and the <a href="https://www.boost.org/doc/libs/1_66_0/libs/numeric/odeint/doc/html/index.html" class="external-link"><code>boost/odeint</code></a>
documentation. See our <a href="comparison.html#integrator_comparison">Integrator comparison</a>
for an idea about how these integrators compare.</p>
<p>Numerical integration options are implemented as named elements of
the global <code><a href="../reference/integrationScheme.html">tensoRphylo::integrationScheme</a></code> object. All of
these integrators are adaptive, so you are not required to specify a
certain <code>dt</code>. To use a particular integrator, provide it to
the <code>TensorPhyloInstance</code> like so:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use the Runge-Kutta 54 (AKA Runge-Kutta-Fehlberg) adaptive</span>
<span class="co"># numerical integrator (also the default, and equivalent to the</span>
<span class="co"># scheme used by diversitree)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setIntegrationScheme</span><span class="op">(</span><span class="va">integrationScheme</span><span class="op">$</span><span class="va">RUNGE_KUTTA54</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="approximators">10.3 Likelihood algorithms<a class="anchor" aria-label="anchor" href="#approximators"></a>
</h3>
<p><code>TensorPhylo</code> implements a few different algorithms for
computing the likelihood. These algorithms differ in how they share
information and/or parallelize calculations across branches. The
algorithm options are implemented as named elements of the global
<code><a href="../reference/approximatorVersion.html">tensoRphylo::approximatorVersion</a></code> object. The default
setting, <code>AUTO_TUNING</code>, initially decides which algorithm to
use based on performance modeling calibrated by extensive simulation; it
then dynamically chooses the best-performing algorithm (and number of
cores, if you’re allowing more than 1) for a particular dataset over the
course of many likelihood calculations. For this reason, we recommend
always using this algorithm</p>
<p>To use a particular algorithm, provide it to the
<code>TensorPhyloInstance</code> like so:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use the SEQUENTIAL_BRANCHWISE algorithm (similar to the one used by</span>
<span class="co"># diversitree)</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setLikelihoodApproximator</span><span class="op">(</span><span class="va">approximatorVersion</span><span class="op">$</span><span class="va">SEQUENTIAL_BRANCHWISE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="error-handling">10.4 Error handling<a class="anchor" aria-label="anchor" href="#error-handling"></a>
</h3>
<p>By default, <code>tensoRphylo</code> checks the parameters you
provide to make sure they conform to certain requirements; for example,
that rate parameters are positive, that the number of rate parameters
matches the number of states and/or rate changes, etc. You can toggle
this behavior (for example, if you want to implement your own error
handling) like so:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># turn off parameter checking</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setSafeMode</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># or turn on parameter checking</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setSafeMode</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="debugging">10.5 Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h3>
<p>You can use built-in <code>TensorPhylo</code> interactive debug mode
to have the internal <code>TensorPhylo</code> object report what
parameter values, settings, and data are being passed from an
<code>R</code> session.</p>
<p>To report to the screen, use:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># report data/parameters/settings to the screen as they are provided</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDebugMode</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>To report to a file, use:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># report data/parameters/settings to a file as they are provided</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDebugFile</span><span class="op">(</span>file <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To turn off debug mode, use:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># turn off debug mode</span>
<span class="va">tp</span><span class="op">$</span><span class="fu">setDebugMode</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-stadler2013can" class="csl-entry">
Stadler, Tanja. 2013. <span>“How Can We Improve Accuracy of
Macroevolutionary Rate Estimates?”</span> <em>Systematic Biology</em> 62
(2): 321–29.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael R. May.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
